<!DOCTYPE html>
<html lang="ko" xmlns:th=http://www.thymeleaf.org
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block th:replace="~{common/layout::setContent(~{this::content})}">
<th:block th:fragment="content">	

	<div class="card m-2">
		<div class="card-header">게시물 목록</div>
		<div class="card-body">
			<div>
				<a href="javascript:getBoardList()" class="btn btn-info btn-sm">GET
					/board/list</a>
				<script th:inline="javascript">
					function getBoardList() {
						$.ajax({
							url: "[(@{/board/list})]",
							/* data: {pageNo:1}, */
							headers: {Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},
						}).done((data) => {
							console.log(data);
							
						});
					}
				</script>
			</div>
		</div>
	</div>

	<!-- 게시물 쓰기 시작 -->
	<div class="card m-2">
		<div class="card-header">게시물 쓰기</div>
		<div class="card-body">
			<div>
				<form id="boardInsertForm">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">제목</span>
						</div>
						<input type="text" name="title" class="form-control">
					</div>

					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">내용</span>
						</div>
						<textarea name="content" class="form-control"></textarea>
					</div>

					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">아이디</span>
						</div>
						<input type="text" name="id" class="form-control" value="user"
							readonly>
					</div>

					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">첨부파일</span>
						</div>
						<input type="file" class="form-control" name="attach">
					</div>

					<div class="mt-3">
						<a href="javascript:createBoard()"
							class="btn btn-info btn-sm mr-2">POST /board/insert</a>
					</div>
				</form>
				<script th:inline="javascript">
				function createBoard() {
					const title = $("#boardInsertForm [name=title]").val();
					const content = $("#boardInsertForm [name=content]").val();
					const id = $("#boardInsertForm [name=id]").val();
					const attach = document.querySelector("#boardInsertForm [name=attach]").files[0];
					
					//Multipart/form-data
					const formData = new FormData();
					formData.append("title", title);
					formData.append("content", content);
					formData.append("id", id);
					if(attach) {
						formData.append("attach", attach);
					}//end if
					
					$.ajax({
						url: "[(@{/board/insert})]",
						headers: {Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},
						method: "post",
						data: formData,
						processData: false,
						contentType: false,
						cache: false
					}).done((data) => {
						console.log(data);
					});
				}
			</script>
			</div>
		</div>
	</div>
	<!-- 게시물 쓰기 끝 -->

	<!-- 게시물 수정 시작 -->
	<div class="card m-2">
		<div class="card-header">게시물 수정</div>
		<div class="card-body">
			<div>
				<form id="boardUpdateForm">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">번호</span>
						</div>
						<input type="text" name="bno" class="form-control">
					</div>
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">제목</span>
						</div>
						<input type="text" name="title" class="form-control">
					</div>

					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">내용</span>
						</div>
						<textarea name="content" class="form-control"></textarea>
					</div>

					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">첨부파일</span>
						</div>
						<input type="file" class="form-control" name="attach">
					</div>

					<div class="mt-3">
						<a href="javascript:updateBoard()"
							class="btn btn-info btn-sm mr-2">POST /board/update</a>
					</div>
				</form>
				<script th:inline="javascript">
				function updateBoard() {
					const bno = $("#boardUpdateForm [name=bno]").val();
					const title = $("#boardUpdateForm [name=title]").val();
					const content = $("#boardUpdateForm [name=content]").val();
					const attach = document.querySelector("#boardUpdateForm [name=attach]").files[0];
					
					//Multipart/form-data
					const formData = new FormData();
					formData.append("bno", bno);
					formData.append("title", title);
					formData.append("content", content);
					if(attach) {
						formData.append("attach", attach);
					}
					
					$.ajax({
						url: "[(@{/board/update})]",
						headers: {Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},
						//multipart/form-data 인코딩된 데이터는 반드시 POST 방식으로 처리(PUT 방식이 아님)
						method: "post",
						data: formData,
						processData: false,
						contentType: false,
						cache: false
					}).done((data) => {
						console.log(data);
					});
				}
			</script>
			</div>
		</div>
	</div>
	<!-- 게시물 수정 끝 -->
	<!-- 게시물 첨부 가져오기 시작 -->
	<div class="card m-2">
		<div class="card-header">게시물 첨부 가져오기</div>
		<div class="card-body">
			<div>
				<form id="downloadAttachForm">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">bno</span>
						</div>
						<input type="text" name="bno" class="form-control">
					</div>
					<div class="mt-3">
						<a href="javascript:downloadAttach()"
							class="btn btn-info btn-sm mr-2">GET /board/battach/{bno}</a>
					</div>
				</form>
				<img id="attachImg" class="mt-2" width="300px" />
				<script th:inline="javascript">
				function downloadAttach() {
					const bno = $("#downloadAttachForm [name=bno]").val();
					const url = "[(@{/board/battach/})]" + bno;
					const jwt = "jwt=" + sessionStorage.getItem("jwt");
					// <img src="http://localhost/board/battach/3344?jwt=xxx"
					$("#attachImg").attr("src", `${url}?${jwt}`);
				}
			</script>
			</div>
		</div>
	</div>
	<!-- 게시물 첨부 가져오기 끝 -->

</th:block>
</th:block>
</html>